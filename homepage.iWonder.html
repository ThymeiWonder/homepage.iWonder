<!DOCTYPE html>
<!-- 
  作者: thyme
  日期: 2025-08-28
  描述: 一个简约的、具有动态背景和多引擎搜索功能的个人主页。
-->
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>homepage.iWonder</title>
    <style>
      /* --- 全局重置和基础样式 --- */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        border: none;
        /* 去除元素聚焦时的默认边框 */
        outline: none;
      }

      body {
        /* 当背景图片不生效时候的默认背景色 */
        background-color: rgba(21, 58, 91, 0.635);
        /* 动态背景图片通过JS设置 */
        background-size: cover;
        /* 图片覆盖整个屏幕 */
        background-repeat: no-repeat;
        /* 图片不重复 */
        background-attachment: fixed;
        /* 背景图片固定，不随滚动条滚动 */
        height: 100vh;
        /* body高度为视口高度 */
        margin: 0;
        font-family: sans-serif;
        /* 默认字体 */
        display: grid;
        /* 使用Grid布局 */
        place-items: center;
        /* 在Grid布局中实现水平和垂直居中 */
      }

      /* --- 搜索框主要样式 --- */
      #search-form {
        width: 36vw;
        /* 宽度为视口宽度的36% */
        height: 46px;
        /* 固定高度 */
        min-width: 300px;
        /* 最小宽度 */
        border: none;
        text-align: center;
        display: grid;
        grid-template-rows: 1fr;
        /* 单行 */
        grid-template-columns: 1fr 15fr 1fr;
        /* 定义三列的比例，用于放置 引擎选择-输入框-搜索按钮 */
        border-radius: 23px;
        /* 圆角 */
        background-color: rgba(
          255,
          255,
          255,
          0.25
        ); /* 降低不透明度以突出玻璃效果 */
        backdrop-filter: blur(10px); /* 玻璃拟态效果 */
        -webkit-backdrop-filter: blur(10px); /* 兼容Safari */
        box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1); /* 柔和的阴影 */
        border: 1px solid rgba(255, 255, 255, 0.18); /* 细微的边框 */
      }

      /* --- 搜索引擎选择器容器 --- */
      #search-engine-container {
        position: relative;
        /* 相对定位，为下拉菜单提供定位上下文 */
        display: grid;
        place-items: center;
      }

      /* --- 当前选中的搜索引擎图标 --- */
      #selected-engine {
        border-radius: 23px;
        background-color: transparent;
        cursor: pointer;
        /* 鼠标悬停时显示手型光标 */
        display: grid;
        place-items: center;
      }

      #selected-engine:hover {
        background-color: rgba(255, 255, 255, 0.7);
      }

      /* --- 搜索引擎下拉选项 --- */
      #engine-options {
        display: none;
        /* 默认隐藏 */
        position: absolute;
        /* 绝对定位，相对于 #search-engine-container */
        top: 100%;
        /* 显示在父元素的正下方 */
        width: 22px;
        background-color: rgba(255, 255, 255, 0.5);
        z-index: 10;
        /* 确保下拉菜单在其他元素之上 */
      }

      /* --- 单个搜索引擎选项 --- */
      .engine-option {
        cursor: pointer;
        display: grid;
        place-items: center;
      }

      .engine-option:hover {
        background-color: rgba(255, 255, 255, 0.7);
      }

      /* --- 搜索按钮 --- */
      #search-button {
        border-radius: 23px;
        background-color: transparent;
        cursor: pointer;
        display: grid;
        place-items: center;
      }

      #search-button:hover {
        background-color: rgba(69, 219, 216, 0.3);
      }

      /* --- 搜索输入框 --- */
      #search-query {
        background-color: transparent;
        font-size: 17px;
      }

      /* --- 搜索框隐藏/显示控制 --- */
      .search-container {
        will-change: transform, opacity; /* 预通知浏览器，优化动画性能 */
        transition: opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1),
          transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        opacity: 1;
        transform: translateY(0);
        visibility: visible;
      }
      .search-container.hidden {
        opacity: 0;
        /* 完全透明 */
        visibility: hidden;
        /* 从渲染树中移除，不可交互 */
        transform: translateY(-20px); /* 向上移动20px，实现从上到下的动画效果 */
        transition: opacity 0.2s cubic-bezier(0.4, 0, 0.2, 1),
          transform 0.2s cubic-bezier(0.4, 0, 0.2, 1), visibility 0s linear 0.2s;
      }
    </style>
  </head>

  <body>
    <!-- 搜索框容器，用于整体控制显示和隐藏 -->
    <div class="search-container hidden">
      <form id="search-form">
        <!-- 搜索引擎选择器 -->
        <div id="search-engine-container">
          <!-- 显示当前选中的引擎图标 -->
          <!-- 默认使用的搜索图标 等待被js通过defaultSearchEngine变量自动填充图标内容-->
          <div id="selected-engine"></div>

          <!-- 搜索引擎下拉选项列表 -->
          <div id="engine-options">
            <!-- Bing -->
            <div class="engine-option" data-value="bing">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="22"
                height="22"
                aria-label="Bing"
                role="img"
                viewBox="0 0 512 512">
                <path
                  d="M145,73l73,26V356l103-59-50-24-32-79,162,57v83L218,439l-73-41Z"
                  fill="#008373"></path>
              </svg>
            </div>
            <!-- Baidu -->
            <div class="engine-option" data-value="baidu">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="22"
                height="22"
                aria-label="Baidu"
                role="img"
                viewBox="0 0 512 512">
                <path
                  d="m131 251c41-9 35-58 34-68-2-17-21-45-48-43-33 3-37 50-37 50-5 22 10 70 51 61m76-82c22 0 40-26 40-58s-18-58-40-58c-23 0-41 26-41 58s18 58 41 58m96 4c31 4 50-28 54-53 4-24-16-52-37-57s-48 29-50 52c-3 27 3 54 33 58m120 41c0-12-10-47-46-47s-41 33-41 57c0 22 2 53 47 52s40-51 40-62m-46 102s-46-36-74-75c-36-57-89-34-106-5-18 29-45 48-49 53-4 4-56 33-44 84 11 52 52 51 52 51s30 3 65-5 65 2 65 2 81 27 104-25c22-53-13-80-13-80"
                  fill="#2319dc"></path>
                <path
                  d="m214 266v34h-28s-29 3-39 35c-3 21 4 34 5 36 1 3 10 19 33 23h53v-128zm-1 107h-21s-15-1-19-18c-3-7 0-16 1-20 1-3 6-11 17-14h22zm38-70v68s1 17 24 23h61v-91h-26v68h-25s-8-1-10-7v-61z"
                  fill="#ffffff"></path>
              </svg>
            </div>
            <!-- Google -->
            <div class="engine-option" data-value="google">
              <svg
                width="22"
                height="22"
                viewBox="-1.6 -1.6 19.20 19.20"
                xmlns="http://www.w3.org/2000/svg"
                fill="none">
                <path
                  fill="#4285F4"
                  d="M14.9 8.161c0-.476-.039-.954-.121-1.422h-6.64v2.695h3.802a3.24 3.24 0 01-1.407 2.127v1.75h2.269c1.332-1.22 2.097-3.02 2.097-5.15z"></path>
                <path
                  fill="#34A853"
                  d="M8.14 15c1.898 0 3.499-.62 4.665-1.69l-2.268-1.749c-.631.427-1.446.669-2.395.669-1.836 0-3.393-1.232-3.952-2.888H1.85v1.803A7.044 7.044 0 008.14 15z"></path>
                <path
                  fill="#FBBC04"
                  d="M4.187 9.342a4.17 4.17 0 010-2.68V4.859H1.849a6.97 6.97 0 000 6.286l2.338-1.803z"></path>
                <path
                  fill="#EA4335"
                  d="M8.14 3.77a3.837 3.837 0 012.7 1.05l2.01-1.999a6.786 6.786 0 00-4.71-1.82 7.042 7.042 0 00-6.29 3.858L4.186 6.66c.556-1.658 2.116-2.89 3.952-2.89z"></path>
              </svg>
            </div>
          </div>
        </div>

        <!-- 搜索查询输入框 -->
        <input
          class="item"
          type="text"
          id="search-query"
          autocomplete="off"
          placeholder="i wonder more about you ..."
          autofocus />

        <!-- 搜索提交按钮 -->
        <button class="item" type="submit" id="search-button">
          <!-- 放大镜图标 -->
          <svg
            height="18"
            width="18"
            version="1.1"
            id="Layer_1"
            xmlns="http://www.w3.org/2000/svg"
            xmlns:xlink="http://www.w3.org/1999/xlink"
            viewBox="0 0 512 512"
            xml:space="preserve"
            fill="#000000">
            <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
            <g
              id="SVGRepo_tracerCarrier"
              stroke-linecap="round"
              stroke-linejoin="round"></g>
            <g id="SVGRepo_iconCarrier">
              <g>
                <path
                  style="fill: #06a0a2"
                  d="M242.832,451.744c-124.528,0-225.84-101.312-225.84-225.872S118.304,0,242.832,0 c124.56,0,225.872,101.312,225.872,225.872S367.392,451.744,242.832,451.744z M242.832,24.848 c-110.816,0-200.992,90.208-200.992,201.024s90.176,201.024,200.992,201.024s201.024-90.208,201.024-201.024 S353.648,24.848,242.832,24.848z"></path>
                <polygon
                  style="fill: #22acdd"
                  points="477.456,512 373.008,407.52 393.936,393.344 495.008,494.432 "></polygon>
              </g>
            </g>
          </svg>
        </button>
      </form>
    </div>

    <!-- 这个空的div用于在Grid布局中占位，将搜索框推到屏幕中间偏上的位置 -->
    <div></div>

    <script>
      // #region 自定义设置区
      // 默认设置 - 当localStorage中没有值时将使用这些设置


      const config = {
        // 默认搜索引擎
        defaultSearchEngine: "baidu",
        // 是否显示搜索框
        isDefaultSearchBoxVisible: "yes",
        // 是否开机随机背景图  若值为"yes", 但imagePath路径为"", 则会一直弹窗提示配置imagePath
        isRandomBackgroundEnabled: "yes",
        // 本地图片文件夹路径
        imagePath: "",
        // 本地图片文件夹路径下的图片名列表
        images: [],
      };

      // 从localStorage加载设置，如果不存在则使用默认值并保存
      function loadConfigFromLocalStorage() {
        for (const key in config) {
          if (Object.prototype.hasOwnProperty.call(config, key)) {
            const element = config[key];
            const savedValue = localStorage.getItem(key);
            if (savedValue !== null) {
              config[key] = JSON.parse(savedValue);
            } else {
              localStorage.setItem(key, JSON.stringify(element));
            }
          }
        }
      }

      function configGet(key) {
        return config[key];
      }

      function configSetAndSyncToLocalStorage(key, value) {
        config[key] = value;
        localStorage.setItem(key, JSON.stringify(value));
      }

      // #endregion 自定义设置区

      // #region 常量区
      // --- DOM元素获取 ---
      const searchContainer = document.querySelector(".search-container");
      const searchQuery = document.getElementById("search-query");
      // --- 搜索引擎切换功能 ---
      const selectedEngine = document.getElementById("selected-engine");
      const engineOptions = document.getElementById("engine-options");
      // #endregion 常量区

      // #region  函数区
      // --- 搜索框显示/隐藏功能 ---

      // 显示搜索框并聚焦到输入框
      function showSearch() {
        if (searchContainer.classList.contains("hidden")) {
          searchQuery.value = "";
          searchContainer.classList.remove("hidden");
          // 更新config并保存状态到localStorage
          configSetAndSyncToLocalStorage("isDefaultSearchBoxVisible", "yes");
        }
        searchQuery.focus();
      }

      // 隐藏搜索框并清空输入内容
      function hideSearch() {
        if (!searchContainer.classList.contains("hidden")) {
          searchContainer.classList.add("hidden");
          // 更新config并保存状态到localStorage
          configSetAndSyncToLocalStorage("isDefaultSearchBoxVisible", "no");
        }
      }

      // --- 动态背景图功能 ---
      function setRandomBackgroundImage(imageNames) {
        // 生成一个随机索引
        const randomIndex = Math.floor(Math.random() * imageNames.length);
        // 根据随机索引获取图片路径
        const randomImage = configGet("imagePath") + imageNames[randomIndex];
        // 设置body的背景图片
        document.body.style.backgroundImage = `url('file:///${randomImage}')`;
      }
      // #endregion 函数区

      // #region  事件注册区
      /*
       * 单击右键时:
       * 1. 禁用默认右键菜单.
       * 2. 当搜索框隐藏时, 显示搜索框.
       * 3. 当点击位置在搜索框之外 且 搜索框显示 且 搜索框内无内容时, 隐藏搜索框.
       * 4. 右键点击要有防抖功能. 短时间内的多次点击, 视为一次点击.
       */
      document.addEventListener("contextmenu", (event) => {
        event.preventDefault();
        // 如果点击搜索框本身, 则无需操作.
        if (searchContainer.contains(event.target)) {
          return;
        }
        if (searchContainer.classList.contains("hidden")) {
          // 如果搜索框是隐藏的, 则显示搜索框.
          showSearch();
        } else if (searchQuery.value === "") {
          // 如果搜索框是显示的, 且搜索框内无内容, 则隐藏搜索框.
          hideSearch();
        }
      });

      // 监听全局键盘事件
      document.addEventListener("keydown", (event) => {
        // 如果按下 'Escape' 键，隐藏搜索框
        if (event.key === "Escape") {
          hideSearch();
          return;
        }
        // 否则，显示搜索框
        showSearch();
      });

      // 监听全局点击事件，如果点击位置不在搜索框内，则显示搜索框
      document.addEventListener("click", (event) => {
        if (!searchContainer.contains(event.target)) {
          showSearch();
        }
      });

      // 点击当前引擎图标，切换下拉菜单的显示/隐藏
      selectedEngine.addEventListener("click", (event) => {
        event.stopPropagation(); // 阻止事件冒泡，防止触发全局点击事件
        engineOptions.style.display =
          engineOptions.style.display === "block" ? "none" : "block";
      });

      // 为每个引擎选项添加点击事件
      document.querySelectorAll(".engine-option").forEach((option) => {
        option.addEventListener("click", () => {
          // 更新当前引擎
          configSetAndSyncToLocalStorage(
            "defaultSearchEngine",
            option.dataset.value
          ); 
          selectedEngine.innerHTML = option.innerHTML; // 更新显示的图标
          engineOptions.style.display = "none"; // 隐藏下拉菜单
        });
      });

      // 点击页面其他地方，隐藏下拉菜单
      document.addEventListener("click", (event) => {
        if (
          !selectedEngine.contains(event.target) &&
          !engineOptions.contains(event.target)
        ) {
          engineOptions.style.display = "none";
        }
      });

      // --- 搜索表单提交功能 ---
      document
        .getElementById("search-form")
        .addEventListener("submit", function (event) {
          event.preventDefault(); // 阻止表单默认的提交行为

          const query = document.getElementById("search-query").value;
          // 如果查询内容为空或只有空格，则不执行搜索
          if (!query.trim()) {
            return;
          }

          let searchUrl;

          // 根据当前选择的搜索引擎构建URL
          switch (configGet("defaultSearchEngine")) {
            case "baidu":
              searchUrl = `https://www.baidu.com/s?wd=${encodeURIComponent(
                query
              )}`;
              break;
            case "google":
              searchUrl = `https://www.google.com/search?q=${encodeURIComponent(
                query
              )}`;
              break;
            case "bing":
              searchUrl = `https://www.bing.com/search?q=${encodeURIComponent(
                query
              )}`;
              break;
          }

          // 如果URL构建成功，在新标签页中打开
          if (searchUrl) {
            window.open(searchUrl, "_blank");
          }
        });

      // 页面加载完成后执行
      document.addEventListener("DOMContentLoaded", () => {
        // 首先加载设置
        loadConfigFromLocalStorage();

        // 初始化当前搜索引擎图标
        selectedEngine.innerHTML = searchContainer.querySelector(
          `div[data-value="${configGet("defaultSearchEngine")}"]`
        ).innerHTML;

        // 设置随机背景图片
        setRandomBackgroundImage(configGet("images"));

        // 根据从localStorage加载的设置来决定是否显示搜索框
        if (configGet("isDefaultSearchBoxVisible") === "yes") {
          showSearch();
        } else {
          // 如果设置为不显示，则确保是隐藏状态
          hideSearch();
          searchContainer.classList.add("hidden");
        }
      });
      // #endregion 事件注册区
    </script>
  </body>
</html>
